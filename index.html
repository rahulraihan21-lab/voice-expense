<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Finance Voice Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --bg-color: #020617;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --accent-glow: #38bdf8;
            --success-glow: #22c55e;
            --danger-glow: #ef4444;
            --text-main: #f8fafc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Hind Siliguri', sans-serif; }
        body { 
            background: radial-gradient(circle at top right, #1e1b4b, #020617);
            color: var(--text-main); 
            min-height: 100vh; 
            padding: 20px; 
            padding-bottom: 120px; 
        }

        .container { max-width: 500px; margin: 0 auto; }
        .card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 24px; 
            margin-bottom: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo { font-size: 1.4rem; font-weight: 700; background: linear-gradient(to right, #38bdf8, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .vault-lock { 
            position: absolute; inset: 0; background: rgba(2, 6, 23, 0.9); 
            z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-radius: 24px; cursor: pointer;
        }
        .amount { font-size: 2.2rem; font-weight: 800; }
        .private-blur { filter: blur(15px); }

        .mic-wave { 
            height: 4px; width: 60px; background: var(--accent-glow); margin: 10px auto; 
            border-radius: 2px; display: none; box-shadow: 0 0 15px var(--accent-glow);
        }
        .mic-wave.active { display: block; animation: wave 1s infinite; }
        @keyframes wave { 0%, 100% { width: 30px; opacity: 0.5; } 50% { width: 80px; opacity: 1; } }

        #reviewContainer, #manualContainer { 
            background: #0f172a; border: 2px solid var(--accent-glow); 
            display: none; padding: 20px; border-radius: 24px; margin-bottom: 20px;
        }

        input, select {
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3);
            color: white; outline: none;
        }

        .btn { flex: 1; padding: 14px; border-radius: 16px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--accent-glow); color: #020617; }
        .btn-success { background: var(--success-glow); color: white; }
        .btn-danger { background: var(--danger-glow); color: white; }
        .btn-sec { background: #1e293b; color: white; }

        .nav-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 450px; display: flex; gap: 10px; z-index: 100; }

        .list-item { background: rgba(255,255,255,0.04); padding: 15px; border-radius: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; }

        .overlay { position: fixed; inset: 0; background: #020617; z-index: 1000; padding: 25px; display: none; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">SmartFinance Pro</div>
        <button onclick="lockVault()" style="background:none; border:none; color:var(--accent-glow); font-weight:600;">üîí ‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="card" style="position:relative; overflow:hidden;">
        <div id="vaultOverlay" class="vault-lock" onclick="unlockVault()">
            <p style="font-size: 0.9rem;">üîì ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶û‡ßç‡¶ö‡ßü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
        </div>
        <div id="vaultContent" class="private-blur">
            <h3 style="font-size: 0.8rem; color: var(--accent-glow);">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶û‡ßç‡¶ö‡ßü (NET)</h3>
            <div id="sum-net" class="amount">‡ß≥ 0</div>
            <div style="display:flex; justify-content: space-between; margin-top:15px; font-size: 0.9rem;">
                <div>‡¶Ü‡ßü: <span id="sum-total-inc" style="color:var(--success-glow)">‡ß≥ 0</span></div>
                <div>‡¶¨‡ßç‡¶Ø‡ßü: <span id="sum-total-exp" style="color:var(--danger-glow)">‡ß≥ 0</span></div>
            </div>
        </div>
    </div>

    <div style="text-align:center; margin-bottom:20px;">
        <div id="statusText" style="font-size: 0.8rem; opacity:0.6;">‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶¨‡¶®‡ßç‡¶ß</div>
        <div id="micWave" class="mic-wave"></div>
        <div id="livePreview" style="font-weight: 600; color: var(--accent-glow); min-height:24px;"></div>
    </div>

    <div id="reviewContainer">
        <h3 style="margin-bottom:15px; color:var(--success-glow);">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <div id="reviewList"></div>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn btn-success" onclick="confirmAndSave()">‚úÖ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn btn-sec" onclick="cancelReview()">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
    </div>

    <div id="manualContainer">
        <h3 style="margin-bottom:10px;">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
        <input type="text" id="manCat" placeholder="‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="number" id="manAmt" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
        <select id="manType">
            <option value="expense">‡¶ñ‡¶∞‡¶ö (Expense)</option>
            <option value="income">‡¶Ü‡ßü (Income)</option>
        </select>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="btn btn-primary" onclick="manualSave()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn btn-sec" onclick="toggleManual(false)">‡¶¨‡¶®‡ßç‡¶ß</button>
        </div>
    </div>

    <h3>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
    <div id="recentList" style="margin-top:10px;"></div>
</div>

<div id="reportOverlay" class="overlay">
    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:25px;">
        <h2>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
        <button onclick="closeReports()" style="background:none; border:none; color:white; font-size:1.5rem;">‚úï</button>
    </div>
    
    <canvas id="reportChart" style="margin-bottom:30px;"></canvas>
    <div id="fullHistory"></div>

    <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="exportToCSV()">üìÇ ‡¶´‡ßã‡¶®‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (CSV)</button>
    <button class="btn btn-sec" style="width:100%; margin-top:10px; border:1px solid #4285F4;" onclick="googleDriveBackup()">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" width="20" style="margin-right:5px;"> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶®
    </button>
    
    <button onclick="clearAllData()" style="width:100%; margin-top:40px; background:none; border:none; color:var(--danger-glow); opacity:0.6;">üóëÔ∏è ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
</div>

<div class="nav-bar">
    <button id="btnStart" class="btn btn-primary" onclick="startRecognition()">üé§ ‡¶¨‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ</button>
    <button id="btnStop" class="btn btn-danger" style="display:none;" onclick="stopRecognition()">üõë ‡¶•‡¶æ‡¶Æ‡ßÅ‡¶®</button>
    <button class="btn btn-sec" onclick="toggleManual(true)">‚ûï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</button>
    <button class="btn btn-sec" onclick="openReports()">üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
</div>

<script>
    let transactions = JSON.parse(localStorage.getItem('sf_pro_final_v1')) || [];
    let passCode = localStorage.getItem('sf_pro_pass') || '1234';
    let pendingEntries = [];

    // Voice Engine
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = true;
    recognition.lang = 'bn-BD';
    recognition.interimResults = true;

    recognition.onresult = (event) => {
        let interim = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
            const text = event.results[i][0].transcript;
            if (event.results[i].isFinal) parseInput(text);
            else interim = text;
        }
        document.getElementById('livePreview').innerText = interim;
    };

    function parseInput(input) {
        const text = input.replace(/[‡ß¶-‡ßØ]/g, d => "‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ".indexOf(d));
        const items = [];
        const segments = text.split(/(‡¶è‡¶¨‡¶Ç|‡¶Ü‡¶∞|,)/);
        segments.forEach(s => {
            const match = s.match(/\d+/);
            if (match) {
                const amount = parseInt(match[0]);
                const type = (text.includes("‡¶á‡¶®‡¶ï‡¶æ‡¶Æ") || text.includes("‡¶Ü‡ßü")) ? 'income' : 'expense';
                let cat = s.replace(/\d+/g, '').replace(/‡¶ü‡¶æ‡¶ï‡¶æ|‡¶á‡¶®‡¶ï‡¶æ‡¶Æ|‡¶Ü‡ßü/g, '').trim() || (type === 'income' ? '‡¶Ü‡ßü' : '‡¶ñ‡¶∞‡¶ö');
                items.push({ type, amount, cat });
            }
        });
        if (items.length > 0) {
            pendingEntries = items;
            document.getElementById('reviewList').innerHTML = items.map(i => `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #1e293b;"><span>${i.cat}</span> <b>‡ß≥ ${i.amount}</b></div>`).join('');
            document.getElementById('reviewContainer').style.display = 'block';
        }
    }

    function confirmAndSave() {
        pendingEntries.forEach(item => {
            transactions.unshift({ id: Date.now() + Math.random(), ...item, date: new Date().toISOString() });
        });
        saveAndReload();
        cancelReview();
    }

    function manualSave() {
        const cat = document.getElementById('manCat').value;
        const amt = parseInt(document.getElementById('manAmt').value);
        const type = document.getElementById('manType').value;
        if (!cat || !amt) return alert("‡¶ò‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
        transactions.unshift({ id: Date.now() + Math.random(), cat, amount: amt, type, date: new Date().toISOString() });
        saveAndReload();
        toggleManual(false);
    }

    function saveAndReload() {
        localStorage.setItem('sf_pro_final_v1', JSON.stringify(transactions));
        updateUI();
    }

    function updateUI() {
        const inc = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
        const exp = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
        document.getElementById('sum-net').innerText = `‡ß≥ ${inc - exp}`;
        document.getElementById('sum-total-inc').innerText = `‡ß≥ ${inc}`;
        document.getElementById('sum-total-exp').innerText = `‡ß≥ ${exp}`;
        document.getElementById('recentList').innerHTML = transactions.slice(0, 5).map(t => `
            <div class="list-item">
                <div><b>${t.cat}</b><br><small style="opacity:0.5">${new Date(t.date).toLocaleDateString('bn-BD')}</small></div>
                <div style="color:${t.type==='income'?'#22c55e':'#ef4444'}">${t.type==='income'?'+':'-'} ‡ß≥ ${t.amount}</div>
            </div>
        `).join('') || '<p style="text-align:center; opacity:0.5;">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</p>';
    }

    // Google Drive Backup Functionality
    function googleDriveBackup() {
        alert("‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø Client ID ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶õ‡¶ø‡•§");
        
        // ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá ‡¶Ø‡¶æ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(transactions));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "SmartFinance_Backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function exportToCSV() {
        let csv = "‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ,‡¶ñ‡¶æ‡¶§,‡¶ß‡¶∞‡¶£,‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£\n" + transactions.map(t => `${new Date(t.date).toLocaleDateString()},${t.cat},${t.type},${t.amount}`).join("\n");
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Finance_Report.csv'; a.click();
    }

    // Standard Helpers
    function unlockVault() { if (prompt("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°?") === passCode) { document.getElementById('vaultOverlay').style.display = 'none'; document.getElementById('vaultContent').classList.remove('private-blur'); } }
    function lockVault() { document.getElementById('vaultOverlay').style.display = 'flex'; document.getElementById('vaultContent').classList.add('private-blur'); }
    function startRecognition() { recognition.start(); document.getElementById('btnStart').style.display = 'none'; document.getElementById('btnStop').style.display = 'flex'; document.getElementById('micWave').classList.add('active'); }
    function stopRecognition() { recognition.stop(); document.getElementById('btnStart').style.display = 'flex'; document.getElementById('btnStop').style.display = 'none'; document.getElementById('micWave').classList.remove('active'); }
    function toggleManual(show) { document.getElementById('manualContainer').style.display = show ? 'block' : 'none'; }
    function openReports() { document.getElementById('reportOverlay').style.display = 'block'; updateChart(); }
    function closeReports() { document.getElementById('reportOverlay').style.display = 'none'; }
    function cancelReview() { document.getElementById('reviewContainer').style.display = 'none'; }

    let chart;
    function updateChart() {
        const ctx = document.getElementById('reportChart').getContext('2d');
        const inc = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
        const exp = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
        if (chart) chart.destroy();
        chart = new Chart(ctx, { type: 'doughnut', data: { labels: ['‡¶Ü‡ßü', '‡¶¨‡ßç‡¶Ø‡ßü'], datasets: [{ data: [inc, exp], backgroundColor: ['#22c55e', '#ef4444'] }] }, options: { plugins: { legend: { labels: { color: 'white' } } } } });
    }

    updateUI();
</script>
</body>
</html>
