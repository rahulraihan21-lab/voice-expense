<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: #111827;
  color: white;
  text-align: center;
}

.container {
  padding: 15px;
  max-width: 600px;
  margin: auto;
}

button {
  padding: 12px;
  margin: 5px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  width: 100%;
}

.primary { background: #2563eb; color: white; }
.danger { background: #dc2626; color: white; }

.card {
  background: #1f2937;
  padding: 15px;
  margin-top: 15px;
  border-radius: 12px;
}

table {
  width: 100%;
  font-size: 14px;
}

canvas {
  max-width: 100%;
}
</style>
</head>
<body>

<div class="container">
<h2>üé§ Voice Expense Tracker</h2>

<button class="primary" onclick="startListening()">‡¶ñ‡¶∞‡¶ö ‡¶¨‡¶≤‡ßÅ‡¶®</button>
<button class="primary" onclick="showMonthlyReport()">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
<button class="danger" onclick="clearAll()">‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>

<h3 id="status"></h3>

<div class="card">
  <h3>‡¶ñ‡¶∞‡¶ö ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
  <table id="expenseTable"></table>
</div>

<div class="card">
  <h3>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</h3>
  <canvas id="expenseChart"></canvas>
</div>

</div>

<script>
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let chart;

function saveData() {
  localStorage.setItem("expenses", JSON.stringify(expenses));
}

function startListening() {
  if (!('webkitSpeechRecognition' in window)) {
    alert("‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶≠‡ßü‡ßá‡¶∏ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§ Chrome ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "bn-BD";
  recognition.start();

  recognition.onresult = function(event) {
    let text = event.results[0][0].transcript;
    processExpense(text);
  };

  recognition.onerror = function() {
    alert("‡¶Æ‡¶æ‡¶á‡¶ï ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç HTTPS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
  };
}

function processExpense(text) {

  // ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‚Üí ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü
  const bnToEn = {
    '‡ß¶':'0','‡ßß':'1','‡ß®':'2','‡ß©':'3','‡ß™':'4',
    '‡ß´':'5','‡ß¨':'6','‡ß≠':'7','‡ßÆ':'8','‡ßØ':'9'
  };

  text = text.replace(/[‡ß¶-‡ßØ]/g, d => bnToEn[d]);

  let number = text.match(/\d+/);

  if (!number) {
    document.getElementById("status").innerText =
      "‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶®‡¶ø üòÖ (‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá ‡¶¨‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®)";
    return;
  }

  let amount = parseInt(number[0]);
  let category = text.replace(number[0], "").trim();

  expenses.push({
    amount,
    category,
    date: new Date().toISOString()
  });

  saveData();
  renderTable();
  renderChart();

  document.getElementById("status").innerText =
    "‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + category + " - " + amount + " ‡¶ü‡¶æ‡¶ï‡¶æ";
}


function renderTable() {
  let table = "<tr><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>X</th></tr>";
  expenses.forEach((item, index) => {
    table += `
      <tr>
        <td>${item.category}</td>
        <td>${item.amount}</td>
        <td><button class="danger" onclick="deleteExpense(${index})">X</button></td>
      </tr>`;
  });
  document.getElementById("expenseTable").innerHTML = table;
}

function deleteExpense(index) {
  expenses.splice(index, 1);
  saveData();
  renderTable();
  renderChart();
}

function clearAll() {
  expenses = [];
  saveData();
  renderTable();
  renderChart();
}

function showMonthlyReport() {
  let now = new Date();
  let total = expenses
    .filter(e => new Date(e.date).getMonth() === now.getMonth())
    .reduce((sum, item) => sum + item.amount, 0);

  document.getElementById("status").innerText =
    "‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: " + total + " ‡¶ü‡¶æ‡¶ï‡¶æ";
}

function renderChart() {
  let categories = {};
  expenses.forEach(item => {
    categories[item.category] =
      (categories[item.category] || 0) + item.amount;
  });

  let labels = Object.keys(categories);
  let data = Object.values(categories);

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("expenseChart"), {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{ data: data }]
    }
  });
}

renderTable();
renderChart();
</script>

</body>
</html>
