<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Expense Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
}
.container{
  max-width:600px;
  margin:auto;
  padding:15px;
}
h2{
  text-align:center;
}
button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border:none;
  border-radius:12px;
  font-size:15px;
  cursor:pointer;
}
.primary{background:#3b82f6;color:white;}
.success{background:#10b981;color:white;}
.danger{background:#ef4444;color:white;}
.card{
  background:#1e293b;
  padding:15px;
  margin-top:15px;
  border-radius:15px;
}
.hidden{display:none;}
table{width:100%;font-size:14px;}
th,td{padding:6px;text-align:left;}
</style>
</head>

<body>
<div class="container">

<h2>üí∏ Smart Expense Pro</h2>

<button class="primary" onclick="startListening()">üé§ ‡¶ñ‡¶∞‡¶ö ‡¶¨‡¶≤‡ßÅ‡¶®</button>
<button class="success" onclick="toggleIncome()">üí∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶Ø‡ßã‡¶ó</button>
<button class="primary" onclick="toggleChart()">üìä ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</button>

<h3 id="status"></h3>

<div class="card">
<h3>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡ß´‡¶ü‡¶ø ‡¶ñ‡¶∞‡¶ö</h3>
<table id="expenseTable"></table>
</div>

<div class="card hidden" id="chartSection">
<h3>‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
<canvas id="expenseChart"></canvas>
<p id="yearly"></p>
</div>

</div>

<script>
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let income = JSON.parse(localStorage.getItem("income")) || [];
let chart;
const deletePassword = "1234";

function saveData(){
  localStorage.setItem("expenses",JSON.stringify(expenses));
  localStorage.setItem("income",JSON.stringify(income));
}

function startListening(){
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){
    alert("Chrome ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®");
    return;
  }
  const recognition = new SpeechRecognition();
  recognition.lang="bn-BD";
  recognition.start();

  recognition.onresult=function(event){
    let text=event.results[0][0].transcript;
    processExpense(text);
  };
}

function processExpense(text){
  const bnToEn={'‡ß¶':'0','‡ßß':'1','‡ß®':'2','‡ß©':'3','‡ß™':'4',
  '‡ß´':'5','‡ß¨':'6','‡ß≠':'7','‡ßÆ':'8','‡ßØ':'9'};
  text=text.replace(/[‡ß¶-‡ßØ]/g,d=>bnToEn[d]);
  let match=text.match(/\d+/);
  if(!match){
    document.getElementById("status").innerText="‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶®‡¶ø üòÖ";
    return;
  }
  let amount=parseInt(match[0]);
  let category=text.replace(match[0],"").trim();

  expenses.unshift({
    amount,
    category,
    date:new Date().toISOString()
  });

  saveData();
  renderTable();
  renderChart();
  document.getElementById("status").innerText=
  "‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá: "+category+" - "+amount+" ‡¶ü‡¶æ‡¶ï‡¶æ";
}

function renderTable(){
  let latest=expenses.slice(0,5);
  let table="<tr><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th></th></tr>";
  latest.forEach((item,index)=>{
    table+=`
    <tr>
    <td>${item.category}</td>
    <td>${item.amount}</td>
    <td><button class="danger" onclick="deleteExpense(${index})">X</button></td>
    </tr>`;
  });
  document.getElementById("expenseTable").innerHTML=table;
}

function deleteExpense(index){
  let pass=prompt("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®:");
  if(pass===deletePassword){
    expenses.splice(index,1);
    saveData();
    renderTable();
    renderChart();
  }else{
    alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‚ùå");
  }
}

function toggleChart(){
  let section=document.getElementById("chartSection");
  section.classList.toggle("hidden");
}

function renderChart(){
  let categories={};
  expenses.forEach(item=>{
    categories[item.category]=(categories[item.category]||0)+item.amount;
  });
  let labels=Object.keys(categories);
  let data=Object.values(categories);
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("expenseChart"),{
    type:'doughnut',
    data:{labels:labels,datasets:[{data:data}]}
  });

  let year=new Date().getFullYear();
  let yearlyTotal=expenses
    .filter(e=>new Date(e.date).getFullYear()===year)
    .reduce((sum,i)=>sum+i.amount,0);

  document.getElementById("yearly").innerText=
  "‡¶è‡¶á ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: "+yearlyTotal+" ‡¶ü‡¶æ‡¶ï‡¶æ";
}

function toggleIncome(){
  let amount=prompt("‡¶Ü‡¶ú ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ?");
  if(amount){
    income.push({
      amount:parseInt(amount),
      date:new Date().toISOString()
    });
    saveData();
    alert("‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚úÖ");
  }
}

renderTable();
renderChart();
</script>

</body>
</html>
